var idmVideoPlayer=Object.create(HTMLElement.prototype);idmVideoPlayer.getDataTags=function(){for(var c,a=0,b=this.attributes,g=b.length;a<g;a++)c=b[a],console.log(c.nodeName,":",c.nodeValue),console.log()};
idmVideoPlayer.generateVideo=function(c,a){console.log("init time:",(new Date).getTime()/1E3);for(var b=this.firstChild,g=b.nextSibling,d=[],f,e=0,h=this.attributes,k=h.length;e<k;e++)f=h[e],f.nodeName.includes("data-idm-")&&(f={key:f.nodeName.replace("data-idm-",""),val:f.nodeValue},d.push(f));console.log("building json :",(new Date).getTime()/1E3);d={response_format:"json",video:{output_formats:[{format:"VIDEO_MP4_V_X264_"+c+"X"+a+"_1600_A_AAC_128"}],data:d,storyboard_id:this.getAttribute("idm-id"),
account_id:2008,priority:"HIGH",authentication_token:document.getElementById("idmplayer").getAttribute("token")}};console.log(d);console.log("sending json :",(new Date).getTime()/1E3);e=new XMLHttpRequest;e.open("POST","https://usa-api.idomoo.com/api/cg",!0);e.setRequestHeader("Content-Type","application/json; charset=UTF-8");e.send(JSON.stringify(d));e.onloadend=function(a){console.log("got response :",(new Date).getTime()/1E3);console.log("got response :",a.target.response);a=JSON.parse(a.target.response).video.output_formats[0].links[0].url;
b.src=a;b.autoPlay=!0;console.log("init play :",(new Date).getTime()/1E3);b.onplaying=function(){g.remove();console.log("play started :",(new Date).getTime()/1E3)};b.play()}};
function initIdmPlayer(){document.registerElement("idm-video",{prototype:idmVideoPlayer});var c=document.getElementsByTagName("idm-video"),a;for(a=0;a<c.length;a++){var b=document.createElement("video");c[a].appendChild(b);b.preload="auto";b.controls=c[a].getAttribute("controls");b.setAttribute("width",c[a].getAttribute("width"));b.setAttribute("height",c[a].getAttribute("height"));b=document.createElement("style");b.type="text/css";b.innerHTML="@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}";
document.getElementsByTagName("head")[0].appendChild(b);b=parseInt(c[a].getAttribute("height"))/2-25;var g=parseInt(c[a].getAttribute("width"))/2-25,d=document.createElement("div");d.setAttribute("style","position:absolute;top:"+b+";left:"+g+";border: 3px solid #f3f3f3;border-top: 3px solid #3498db;border-radius: 50%;width: 50px;height: 50px;animation: spin 1s linear infinite;");c[a].appendChild(d);c[a].generateVideo(c[a].getAttribute("width"),c[a].getAttribute("height"))}};
